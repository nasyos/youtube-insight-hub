# ç’°å¢ƒå¤‰æ•°èª­ã¿è¾¼ã¿å•é¡Œï¼šåŸå› ã¨ä¿®æ­£æ¡ˆ

## ğŸ” åŸå› å€™è£œ

### åŸå› 1: `vite.config.ts`ã®`define`ã‚»ã‚¯ã‚·ãƒ§ãƒ³ãŒä¸è¦ï¼ˆæœ€é‡è¦ï¼‰

**å•é¡Œç‚¹**:
- `vite.config.ts`ã§`define`ã‚’ä½¿ã£ã¦`process.env.*`ã«æ³¨å…¥ã—ã¦ã„ã‚‹ãŒã€ã‚¢ãƒ—ãƒªå´ã§ã¯`import.meta.env`ã‚’ä½¿ç”¨
- Viteã¯**è‡ªå‹•çš„ã«**`VITE_`ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ã®ç’°å¢ƒå¤‰æ•°ã‚’`import.meta.env`ã«æ³¨å…¥ã™ã‚‹ãŸã‚ã€`define`ã¯ä¸è¦
- `define`ã§`process.env.*`ã«æ³¨å…¥ã—ã¦ã‚‚ã€ã‚¢ãƒ—ãƒªå´ã§`import.meta.env`ã‚’å‚ç…§ã—ã¦ã„ã‚‹ãŸã‚ä¸ä¸€è‡´

**å½±éŸ¿**:
- Gemini APIã‚­ãƒ¼ã¯`define`ã§æ³¨å…¥ã•ã‚Œã¦ã„ã‚‹ãŒã€ã‚¢ãƒ—ãƒªå´ã§ã¯`import.meta.env.VITE_GEMINI_API_KEY`ã‚’å‚ç…§ã—ã¦ã„ã‚‹ãŸã‚ã€`define`ã®åŠ¹æœãŒãªã„
- Supabaseã®ç’°å¢ƒå¤‰æ•°ã¯`define`ã§æ³¨å…¥ã•ã‚Œã¦ã„ãªã„ãŸã‚ã€å®Œå…¨ã«æœªè¨­å®š

### åŸå› 2: `loadEnv`ã®ç¬¬2å¼•æ•°ãŒç›¸å¯¾ãƒ‘ã‚¹

**å•é¡Œç‚¹**:
- `loadEnv(mode, '.', '')`ã®`'.'`ãŒç¾åœ¨ã®ä½œæ¥­ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ä¾å­˜ã™ã‚‹å¯èƒ½æ€§
- ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã‹ã‚‰å®Ÿè¡Œã—ã¦ã„ãªã„å ´åˆã€`.env.local`ã‚’è¦‹ã¤ã‘ã‚‰ã‚Œãªã„

### åŸå› 3: `.env.local`ãƒ•ã‚¡ã‚¤ãƒ«ã®å½¢å¼ã‚„å ´æ‰€ã®å•é¡Œ

**ç¢ºèªäº‹é …**:
- ãƒ•ã‚¡ã‚¤ãƒ«åãŒ`.env.local.txt`ã«ãªã£ã¦ã„ãªã„ã‹ï¼ˆWindowsã®æ‹¡å¼µå­éè¡¨ç¤ºè¨­å®šï¼‰
- ãƒ•ã‚¡ã‚¤ãƒ«ãŒãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆï¼ˆ`package.json`ã¨åŒã˜ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªï¼‰ã«ã‚ã‚‹ã‹
- å€¤ã«ä½™åˆ†ãªã‚¹ãƒšãƒ¼ã‚¹ã‚„å¼•ç”¨ç¬¦ãŒãªã„ã‹

---

## âœ… æ¤œè¨¼æ‰‹é †

### ã‚¹ãƒ†ãƒƒãƒ—1: `.env.local`ãƒ•ã‚¡ã‚¤ãƒ«ã®ç¢ºèª

```powershell
# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã§å®Ÿè¡Œ
cd d:\work\youtube-insight-hub
dir /a .env*
type .env.local
```

**ç¢ºèªãƒã‚¤ãƒ³ãƒˆ**:
- ãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã™ã‚‹ã‹
- ãƒ•ã‚¡ã‚¤ãƒ«åãŒæ­£ç¢ºã«`.env.local`ã‹ï¼ˆ`.env.local.txt`ã§ã¯ãªã„ã‹ï¼‰
- å„è¡ŒãŒ`VITE_*=å€¤`ã®å½¢å¼ã‹
- å€¤ã«å¼•ç”¨ç¬¦ã‚„ä½™åˆ†ãªã‚¹ãƒšãƒ¼ã‚¹ãŒãªã„ã‹

### ã‚¹ãƒ†ãƒƒãƒ—2: ãƒ–ãƒ©ã‚¦ã‚¶ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ç¢ºèª

é–‹ç™ºã‚µãƒ¼ãƒãƒ¼èµ·å‹•å¾Œã€ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ï¼ˆF12ï¼‰ã§ä»¥ä¸‹ã‚’ç¢ºèªï¼š

```javascript
// ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ç›´æ¥å®Ÿè¡Œ
console.log(import.meta.env)
console.log(import.meta.env.VITE_GEMINI_API_KEY)
console.log(import.meta.env.VITE_SUPABASE_URL)
```

**æœŸå¾…ã•ã‚Œã‚‹çµæœ**:
- `import.meta.env`ã«`VITE_*`ã§å§‹ã¾ã‚‹ã‚­ãƒ¼ãŒå«ã¾ã‚Œã¦ã„ã‚‹
- å„ç’°å¢ƒå¤‰æ•°ã®å€¤ãŒæ­£ã—ãè¡¨ç¤ºã•ã‚Œã‚‹

---

## ğŸ› ï¸ ç¢ºå®Ÿãªä¿®æ­£æ¡ˆï¼ˆæœ€çŸ­ï¼‰

### ä¿®æ­£æ–¹é‡: `define`ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’å‰Šé™¤ã—ã€Viteã®è‡ªå‹•æ³¨å…¥ã«ä»»ã›ã‚‹

Viteã¯`VITE_`ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ã®ç’°å¢ƒå¤‰æ•°ã‚’è‡ªå‹•çš„ã«`import.meta.env`ã«æ³¨å…¥ã™ã‚‹ãŸã‚ã€`define`ã¯ä¸è¦ã§ã™ã€‚

### ä¿®æ­£ã‚³ãƒ¼ãƒ‰

#### `vite.config.ts`ã®ä¿®æ­£

```typescript
import path from 'path';
import { defineConfig } from 'vite';  // loadEnvã¯ä¸è¦
import react from '@vitejs/plugin-react';

export default defineConfig({
  root: '.',
  server: {
    port: 3000,
    host: '0.0.0.0',
    fs: {
      strict: false
    }
  },
  plugins: [react()],
  // defineã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’å‰Šé™¤ï¼ˆViteãŒè‡ªå‹•ã§import.meta.envã«æ³¨å…¥ã™ã‚‹ï¼‰
  resolve: {
    alias: {
      '@': path.resolve(__dirname, '.'),
    }
  },
  optimizeDeps: {
    include: ['react', 'react-dom']
  }
});
```

**å¤‰æ›´ç‚¹**:
1. `loadEnv`ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚’å‰Šé™¤
2. `defineConfig`ã®å¼•æ•°ã‚’é–¢æ•°ã‹ã‚‰ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å¤‰æ›´ï¼ˆ`mode`ã¨`loadEnv`ãŒä¸è¦ã«ãªã£ãŸãŸã‚ï¼‰
3. `define`ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’å®Œå…¨ã«å‰Šé™¤

---

## ğŸ“ ã‚¢ãƒ—ãƒªå´ã®ã‚³ãƒ¼ãƒ‰ï¼ˆæ—¢ã«æ­£ã—ã„ï¼‰

ç¾åœ¨ã®ã‚¢ãƒ—ãƒªå´ã®ã‚³ãƒ¼ãƒ‰ã¯æ—¢ã«æ­£ã—ã`import.meta.env`ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ãŸã‚ã€å¤‰æ›´ä¸è¦ã§ã™ã€‚

### `lib/supabase.ts`ï¼ˆæ­£ã—ã„å®Ÿè£…ï¼‰

```typescript
const env = (import.meta as any).env || {};
const supabaseUrl = env.VITE_SUPABASE_URL || '';
const supabaseAnonKey = env.VITE_SUPABASE_ANON_KEY || '';
```

### `services/geminiService.ts`ï¼ˆæ­£ã—ã„å®Ÿè£…ï¼‰

```typescript
const env = (import.meta as any).env || {};
const apiKey = env.VITE_GEMINI_API_KEY || env.GEMINI_API_KEY;
```

---

## ğŸ”§ ä¿®æ­£å¾Œã®å‹•ä½œç¢ºèª

### 1. é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ã‚’å†èµ·å‹•

```powershell
# ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§ Ctrl+C ã§åœæ­¢
# ãã®å¾Œ
npm run dev
```

### 2. ãƒ–ãƒ©ã‚¦ã‚¶ã§ç¢ºèª

1. `http://localhost:3000`ã‚’é–‹ã
2. é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ«ï¼ˆF12ï¼‰ã‚’é–‹ã
3. ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚¿ãƒ–ã§ä»¥ä¸‹ã‚’ç¢ºèªï¼š

**æœŸå¾…ã•ã‚Œã‚‹è¡¨ç¤º**:
```
ğŸ” [ãƒ‡ãƒãƒƒã‚°] import.meta.env ã®å†…å®¹: {
  DEV: true,
  MODE: "development",
  VITE_GEMINI_API_KEY: "AIzaSyC0fIP7Nq1PdM4ttgw...",
  VITE_SUPABASE_URL: "https://vgscuhunmcpozsjlorfh.supabase.co...",
  VITE_SUPABASE_ANON_KEY: "sb_publishable_HsmW3Hd0kQ...",
  allKeys: ["VITE_GEMINI_API_KEY", "VITE_SUPABASE_URL", "VITE_SUPABASE_ANON_KEY"]
}
âœ… Supabaseæ¥ç¶šè¨­å®šãŒç¢ºèªã•ã‚Œã¾ã—ãŸ
âœ… Gemini APIã‚­ãƒ¼ãŒæ­£å¸¸ã«è¨­å®šã•ã‚Œã¾ã—ãŸ
```

---

## ğŸ¯ SupabaseåˆæœŸåŒ–ã®æ­£ã—ã„å‚ç…§ä¾‹

### `lib/supabase.ts`ã§ã®æ­£ã—ã„å®Ÿè£…

```typescript
import { createClient } from '@supabase/supabase-js';

// Viteã§ã¯ import.meta.env ã‚’ä½¿ç”¨
const supabaseUrl = import.meta.env.VITE_SUPABASE_URL;
const supabaseAnonKey = import.meta.env.VITE_SUPABASE_ANON_KEY;

// ç’°å¢ƒå¤‰æ•°ã®æ¤œè¨¼
if (!supabaseUrl || !supabaseAnonKey) {
  console.warn('âš ï¸ Supabaseç’°å¢ƒå¤‰æ•°ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“');
  // ãƒ€ãƒŸãƒ¼ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’ä½œæˆï¼ˆã‚¨ãƒ©ãƒ¼ã‚’é˜²ããŸã‚ï¼‰
  export const supabase = createClient('https://placeholder.supabase.co', 'placeholder-key');
} else {
  // æ­£ã—ã„ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’ä½œæˆ
  export const supabase = createClient(supabaseUrl, supabaseAnonKey);
  console.log('âœ… Supabaseæ¥ç¶šè¨­å®šãŒç¢ºèªã•ã‚Œã¾ã—ãŸ');
}
```

---

## ğŸ“‹ ã¾ã¨ã‚

### æœ€çŸ­ä¿®æ­£æ‰‹é †

1. **`vite.config.ts`ã‚’ä¿®æ­£**ï¼ˆ`define`ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’å‰Šé™¤ï¼‰
2. **é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ã‚’å†èµ·å‹•**ï¼ˆ`Ctrl+C` â†’ `npm run dev`ï¼‰
3. **ãƒ–ãƒ©ã‚¦ã‚¶ã‚’ãƒªãƒ­ãƒ¼ãƒ‰**ï¼ˆF5ï¼‰
4. **ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ç¢ºèª**ï¼ˆF12ï¼‰

### ãªãœã“ã®ä¿®æ­£ã§è§£æ±ºã™ã‚‹ã‹

- Viteã¯`VITE_`ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ã®ç’°å¢ƒå¤‰æ•°ã‚’è‡ªå‹•çš„ã«`import.meta.env`ã«æ³¨å…¥ã™ã‚‹
- `define`ã‚’ä½¿ã†å¿…è¦ã¯ãªãã€ã‚€ã—ã‚æ··ä¹±ã‚’æ‹›ã
- ã‚¢ãƒ—ãƒªå´ã®ã‚³ãƒ¼ãƒ‰ã¯æ—¢ã«æ­£ã—ã`import.meta.env`ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹
- `define`ã‚’å‰Šé™¤ã™ã‚‹ã“ã¨ã§ã€Viteã®æ¨™æº–çš„ãªå‹•ä½œã«å¾“ã†

---

## âš ï¸ è£œè¶³ï¼šã‚‚ã—`process.env`ã‚’ä½¿ã„ãŸã„å ´åˆ

ã‚‚ã—ä½•ã‚‰ã‹ã®ç†ç”±ã§`process.env`ã‚’ä½¿ã„ãŸã„å ´åˆã¯ã€**ã™ã¹ã¦ã®ç’°å¢ƒå¤‰æ•°**ã‚’`define`ã§æ˜ç¤ºã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼š

```typescript
export default defineConfig(({ mode }) => {
  const env = loadEnv(mode, process.cwd(), '');
  return {
    // ...
    define: {
      'process.env.VITE_GEMINI_API_KEY': JSON.stringify(env.VITE_GEMINI_API_KEY || ''),
      'process.env.VITE_SUPABASE_URL': JSON.stringify(env.VITE_SUPABASE_URL || ''),
      'process.env.VITE_SUPABASE_ANON_KEY': JSON.stringify(env.VITE_SUPABASE_ANON_KEY || ''),
    }
  };
});
```

ã—ã‹ã—ã€**æ¨å¥¨ã¯`import.meta.env`ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨**ã§ã™ã€‚Viteã®æ¨™æº–çš„ãªæ–¹æ³•ã§ã‚ã‚Šã€è¨­å®šãŒä¸è¦ã§ã€å‹å®‰å…¨æ€§ã‚‚é«˜ã„ã§ã™ã€‚

