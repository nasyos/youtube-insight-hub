# YouTube Insight Hub - 実装計画

## 📋 次のステップ（優先順位順）

### 🎯 フェーズ1: データベース連携（最優先）

**理由**: 
- 現在LocalStorageのみで、複数デバイス間で同期不可
- 自動化機能（定期クローリング、Webhook）にはサーバーサイドのデータストレージが必要
- 他の機能の基盤となる

**実装内容**:
1. **データベース選択**: Vercel Postgres または Supabase（推奨: Supabase - 無料枠が充実）
2. **APIエンドポイント作成**: 
   - `api/channels.ts` - チャンネル一覧取得・追加・削除
   - `api/summaries.ts` - 要約一覧取得・保存
3. **フロントエンド修正**: `App.tsx` をAPI経由でデータ取得するように変更
4. **データ移行機能**: 既存のLocalStorageデータをデータベースにインポート

**所要時間**: 4-6時間

---

### 🔄 フェーズ2: Google Chat配信機能

**理由**:
- 既に `googleConfig.chatWebhookUrl` の設定項目がある
- 実装が比較的簡単（Webhook送信のみ）
- ユーザー価値が高い

**実装内容**:
1. **送信関数の実装**: `App.tsx` に `sendToGoogleChat()` 関数を追加
2. **自動送信機能**: 新しい要約が生成されたときに自動送信
3. **設定UI**: 自動送信のON/OFF切り替え
4. **エラーハンドリング**: 送信失敗時の処理

**所要時間**: 1-2時間

---

### ⏰ フェーズ3: 定期クローリング機能

**理由**:
- 自動化の核心機能
- データベース連携後に実装可能

**実装内容**:
1. **Vercel Serverless Function作成**: `api/cron/scan-channels.ts`
2. **Vercel Cron Jobs設定**: `vercel.json` にcron設定を追加
3. **スキャンロジック**: データベースからチャンネル一覧を取得してスキャン
4. **重複チェック**: 既存の要約と比較して新規のみ保存

**所要時間**: 3-4時間

---

### 🔔 フェーズ4: Webhook機能

**理由**:
- リアルタイム通知を実現
- YouTube PubSubHubbubの設定が必要で実装が複雑

**実装内容**:
1. **Webhookエンドポイント作成**: `api/webhook/youtube.ts`
2. **PubSubHubbub検証**: YouTubeからの検証リクエストに対応
3. **通知処理**: 新しい動画の通知を受信して処理
4. **YouTube Data API設定**: チャンネル購読の設定

**所要時間**: 4-5時間

---

## 🚀 推奨実装順序

### ステップ1: データベース連携（今すぐ開始）

**具体的な作業**:

1. **Supabaseプロジェクト作成**
   - [Supabase](https://supabase.com) でアカウント作成
   - 新しいプロジェクトを作成
   - 接続情報を取得

2. **データベーススキーマ作成**
   ```sql
   -- channels テーブル
   CREATE TABLE channels (
     id VARCHAR PRIMARY KEY,
     name VARCHAR NOT NULL,
     handle VARCHAR NOT NULL,
     last_checked TIMESTAMP,
     thumbnail_url VARCHAR,
     created_at TIMESTAMP DEFAULT NOW()
   );

   -- summaries テーブル
   CREATE TABLE summaries (
     id VARCHAR PRIMARY KEY,
     title VARCHAR NOT NULL,
     published_at TIMESTAMP,
     thumbnail_url VARCHAR,
     summary TEXT,
     key_points JSONB,
     channel_id VARCHAR REFERENCES channels(id),
     channel_title VARCHAR,
     url VARCHAR UNIQUE,
     doc_url VARCHAR,
     created_at TIMESTAMP DEFAULT NOW()
   );
   ```

3. **APIエンドポイント作成**
   - `api/channels.ts` を作成
   - `api/summaries.ts` を作成

4. **フロントエンド修正**
   - `App.tsx` のLocalStorage読み書きをAPI呼び出しに変更

---

## 📝 今すぐ始めるべきこと

### オプションA: データベース連携から始める（推奨）

**次のアクション**:
1. Supabaseアカウント作成
2. データベーススキーマ作成
3. APIエンドポイント実装
4. フロントエンド修正

### オプションB: 簡単な機能から始める

**次のアクション**:
1. Google Chat配信機能の実装（1-2時間で完了）
2. その後、データベース連携に移行

---

## 🛠️ 実装に必要な準備

### 環境変数（追加が必要）
```
SUPABASE_URL=your_supabase_url
SUPABASE_ANON_KEY=your_supabase_anon_key
```

### 依存関係（追加が必要）
```json
{
  "dependencies": {
    "@supabase/supabase-js": "^2.39.0"
  }
}
```

---

## ❓ どちらから始めますか？

1. **データベース連携** - 長期的な基盤構築（推奨）
2. **Google Chat配信** - すぐに価値を提供できる機能
3. **その他の機能** - ご希望があれば教えてください

