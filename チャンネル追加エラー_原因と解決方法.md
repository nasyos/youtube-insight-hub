# ãƒãƒ£ãƒ³ãƒãƒ«è¿½åŠ ã‚¨ãƒ©ãƒ¼ï¼šåŸå› ã¨è§£æ±ºæ–¹æ³•

## ğŸ” ã‚¨ãƒ©ãƒ¼ã®åŸå› 

ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«ä»¥ä¸‹ã®ã‚¨ãƒ©ãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã¾ã™ï¼š
```
ApiError: {"error": {"code":400,"message": "API key not valid. Please pass a valid API key.", "status":"INVALID_ARGUMENT"}}
```

**åŸå› **: Gemini APIã‚­ãƒ¼ãŒç„¡åŠ¹ã§ã™ã€‚ç’°å¢ƒå¤‰æ•°ã¯æ­£ã—ãèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã™ãŒã€APIã‚­ãƒ¼è‡ªä½“ãŒç„¡åŠ¹ã€æœŸé™åˆ‡ã‚Œã€ã¾ãŸã¯æ¨©é™ãŒä¸è¶³ã—ã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

---

## ğŸ“‹ ãƒãƒ£ãƒ³ãƒãƒ«è¿½åŠ ã®å‡¦ç†ãƒ•ãƒ­ãƒ¼

### 1. ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œ
- `App.tsx` ã® `handleAddChannel` é–¢æ•°ï¼ˆ207è¡Œç›®ï¼‰ãŒå‘¼ã°ã‚Œã‚‹
- ãƒ•ã‚©ãƒ¼ãƒ ã§å…¥åŠ›ã•ã‚ŒãŸãƒãƒ£ãƒ³ãƒãƒ«åï¼ˆä¾‹: `@programming_tutorial_youtube`ï¼‰ãŒ `searchQuery` ã«æ ¼ç´ã•ã‚Œã‚‹

### 2. ãƒãƒ£ãƒ³ãƒãƒ«æƒ…å ±ã®å–å¾—
- `App.tsx` 213è¡Œç›®: `gemini.current.findChannel(searchQuery)` ãŒå‘¼ã°ã‚Œã‚‹
- `services/geminiService.ts` ã® `findChannel` ãƒ¡ã‚½ãƒƒãƒ‰ï¼ˆ121è¡Œç›®ï¼‰ãŒå®Ÿè¡Œã•ã‚Œã‚‹

### 3. Gemini APIå‘¼ã³å‡ºã—
- `findChannel` ãƒ¡ã‚½ãƒƒãƒ‰å†…ã§Gemini APIã‚’ä½¿ç”¨ã—ã¦ãƒãƒ£ãƒ³ãƒãƒ«æƒ…å ±ã‚’æ¤œç´¢
- ä½¿ç”¨ã™ã‚‹API: `gemini-3-flash-preview` ãƒ¢ãƒ‡ãƒ«
- Google Search groundingæ©Ÿèƒ½ã‚’ä½¿ç”¨ã—ã¦ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—

### 4. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¸ã®ä¿å­˜
- ãƒãƒ£ãƒ³ãƒãƒ«æƒ…å ±ãŒå–å¾—ã§ããŸã‚‰ã€`api.current.addChannel(channel)` ã§Supabaseã«ä¿å­˜

---

## ğŸ› ï¸ è§£æ±ºæ–¹æ³•

### æ–¹æ³•1: Gemini APIã‚­ãƒ¼ã®ç¢ºèªã¨å†ç”Ÿæˆ

1. **Google AI Studioã§APIã‚­ãƒ¼ã‚’ç¢ºèª**
   - [Google AI Studio](https://aistudio.google.com/app/apikey) ã«ã‚¢ã‚¯ã‚»ã‚¹
   - ç¾åœ¨ã®APIã‚­ãƒ¼ãŒæœ‰åŠ¹ã‹ç¢ºèª

2. **APIã‚­ãƒ¼ã‚’å†ç”Ÿæˆ**
   - æ—¢å­˜ã®APIã‚­ãƒ¼ã‚’å‰Šé™¤
   - æ–°ã—ã„APIã‚­ãƒ¼ã‚’ä½œæˆ
   - `.env.local` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ›´æ–°

3. **é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ã‚’å†èµ·å‹•**
   ```bash
   # Ctrl+C ã§åœæ­¢
   npm run dev
   ```

### æ–¹æ³•2: APIã‚­ãƒ¼ã®æ¨©é™ç¢ºèª

1. **Google Cloud Consoleã§ç¢ºèª**
   - [Google Cloud Console](https://console.cloud.google.com) ã«ã‚¢ã‚¯ã‚»ã‚¹
   - ã€ŒAPIã¨ã‚µãƒ¼ãƒ“ã‚¹ã€â†’ã€Œèªè¨¼æƒ…å ±ã€ã‚’é–‹ã
   - APIã‚­ãƒ¼ã‚’é¸æŠ
   - ã€ŒAPIã®åˆ¶é™ã€ã§ä»¥ä¸‹ãŒæœ‰åŠ¹ã«ãªã£ã¦ã„ã‚‹ã‹ç¢ºèªï¼š
     - âœ… **Generative Language API**ï¼ˆå¿…é ˆï¼‰

2. **APIã®æœ‰åŠ¹åŒ–**
   - ã€ŒAPIã¨ã‚µãƒ¼ãƒ“ã‚¹ã€â†’ã€Œãƒ©ã‚¤ãƒ–ãƒ©ãƒªã€ã‚’é–‹ã
   - ã€ŒGenerative Language APIã€ã‚’æ¤œç´¢
   - æœ‰åŠ¹åŒ–ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª

### æ–¹æ³•3: ä¸€æ™‚çš„ãªå›é¿ç­–ï¼ˆæ‰‹å‹•ã§ãƒãƒ£ãƒ³ãƒãƒ«æƒ…å ±ã‚’å…¥åŠ›ï¼‰

APIã‚­ãƒ¼ã®å•é¡ŒãŒè§£æ±ºã™ã‚‹ã¾ã§ã®é–“ã€æ‰‹å‹•ã§ãƒãƒ£ãƒ³ãƒãƒ«æƒ…å ±ã‚’å…¥åŠ›ã™ã‚‹æ–¹æ³•ï¼š

1. **Supabaseã®Table Editorã§ç›´æ¥è¿½åŠ **
   - Supabaseãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚’é–‹ã
   - ã€ŒTable Editorã€â†’ã€Œchannelsã€ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’é–‹ã
   - æ‰‹å‹•ã§ãƒãƒ£ãƒ³ãƒãƒ«æƒ…å ±ã‚’è¿½åŠ 

2. **ã‚³ãƒ¼ãƒ‰ã‚’ä¸€æ™‚çš„ã«ä¿®æ­£**
   - `App.tsx` ã® `handleAddChannel` ã‚’ä¿®æ­£ã—ã¦ã€APIå‘¼ã³å‡ºã—ã‚’ã‚¹ã‚­ãƒƒãƒ—
   - æ‰‹å‹•ã§ãƒãƒ£ãƒ³ãƒãƒ«æƒ…å ±ã‚’å…¥åŠ›ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹

---

## ğŸ“ ç¾åœ¨ã®å®Ÿè£…è©³ç´°

### `App.tsx` (207-232è¡Œç›®)

```typescript
const handleAddChannel = async (e: React.FormEvent) => {
  e.preventDefault();
  if (!searchQuery.trim() || isAdding) return;
  setIsAdding(true);
  setError(null);
  try {
    // Gemini APIã‚’ä½¿ç”¨ã—ã¦ãƒãƒ£ãƒ³ãƒãƒ«æƒ…å ±ã‚’æ¤œç´¢
    const channel = await gemini.current.findChannel(searchQuery);
    if (channel) {
      if (!channels.some(c => c.handle === channel.handle)) {
        // ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ä¿å­˜
        const savedChannel = await api.current.addChannel(channel);
        setChannels(prev => [...prev, savedChannel]);
        setSearchQuery('');
      } else {
        setError('ã“ã®ãƒãƒ£ãƒ³ãƒãƒ«ã¯æ—¢ã«è¿½åŠ ã•ã‚Œã¦ã„ã¾ã™ã€‚');
      }
    } else {
      setError('ãƒãƒ£ãƒ³ãƒãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚');
    }
  } catch (err: any) {
    console.error('ãƒãƒ£ãƒ³ãƒãƒ«è¿½åŠ ã‚¨ãƒ©ãƒ¼:', err);
    setError(err.message || 'è¿½åŠ ã‚¨ãƒ©ãƒ¼');
  } finally {
    setIsAdding(false);
  }
};
```

### `services/geminiService.ts` (121-157è¡Œç›®)

```typescript
async findChannel(query: string): Promise<TrackedChannel | null> {
  this.ensureApiKey();  // APIã‚­ãƒ¼ã®å­˜åœ¨ç¢ºèª
  if (!this.ai) throw new Error('Gemini APIãŒåˆæœŸåŒ–ã•ã‚Œã¦ã„ã¾ã›ã‚“');
  
  const prompt = `YouTubeãƒãƒ£ãƒ³ãƒãƒ«ã€Œ${query}ã€ã®è©³ç´°æƒ…å ±ã‚’æ¢ã—ã¦ãã ã•ã„ã€‚ãƒãƒ£ãƒ³ãƒãƒ«åã€ãƒãƒ³ãƒ‰ãƒ«å(@ã‹ã‚‰å§‹ã¾ã‚‹ID)ã€ã‚¢ã‚¤ã‚³ãƒ³ç”¨ã®URLã‚’è¦‹ã¤ã‘ã¦ãã ã•ã„ã€‚`;
  
  try {
    const response = await this.ai.models.generateContent({
      model: 'gemini-3-flash-preview',
      contents: prompt,
      config: {
        tools: [{ googleSearch: {} }],
        responseMimeType: "application/json",
        responseSchema: {
          type: Type.OBJECT,
          properties: {
            name: { type: Type.STRING },
            handle: { type: Type.STRING },
            thumbnailUrl: { type: Type.STRING }
          },
          required: ["name", "handle"]
        }
      }
    });

    const data = JSON.parse(response.text || "{}");
    if (!data.name) return null;

    return {
      id: Math.random().toString(36).substr(2, 9),
      name: data.name,
      handle: data.handle,
      lastChecked: new Date().toISOString(),
      thumbnailUrl: data.thumbnailUrl || `https://picsum.photos/seed/${data.name}/150/150`
    };
  } catch (error) {
    console.error("Find Channel Error:", error);
    return null;
  }
}
```

---

## âœ… ç¢ºèªæ‰‹é †

1. **ç’°å¢ƒå¤‰æ•°ã®ç¢ºèª**
   - `.env.local` ãƒ•ã‚¡ã‚¤ãƒ«ã§ `VITE_GEMINI_API_KEY` ãŒæ­£ã—ãè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
   - å€¤ã«ä½™åˆ†ãªã‚¹ãƒšãƒ¼ã‚¹ã‚„å¼•ç”¨ç¬¦ãŒãªã„ã‹ç¢ºèª

2. **APIã‚­ãƒ¼ã®æœ‰åŠ¹æ€§ç¢ºèª**
   - [Google AI Studio](https://aistudio.google.com/app/apikey) ã§APIã‚­ãƒ¼ãŒæœ‰åŠ¹ã‹ç¢ºèª
   - æ–°ã—ã„APIã‚­ãƒ¼ã‚’ç”Ÿæˆã—ã¦è©¦ã™

3. **APIã®æœ‰åŠ¹åŒ–ç¢ºèª**
   - Google Cloud Consoleã§ã€ŒGenerative Language APIã€ãŒæœ‰åŠ¹åŒ–ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª

4. **é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ã®å†èµ·å‹•**
   - ç’°å¢ƒå¤‰æ•°ã‚’å¤‰æ›´ã—ãŸã‚‰ã€å¿…ãšé–‹ç™ºã‚µãƒ¼ãƒãƒ¼ã‚’å†èµ·å‹•

---

## ğŸ¯ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

1. Gemini APIã‚­ãƒ¼ã‚’å†ç”Ÿæˆ
2. `.env.local` ã‚’æ›´æ–°
3. é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ã‚’å†èµ·å‹•
4. å†åº¦ãƒãƒ£ãƒ³ãƒãƒ«è¿½åŠ ã‚’è©¦ã™

å•é¡ŒãŒè§£æ±ºã—ãªã„å ´åˆã¯ã€Google Cloud Consoleã®è¨­å®šã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚

