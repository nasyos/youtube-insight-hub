# Gemini API 設定確認ガイド

## 🔍 現在の実装状況

### 認証方法
- **使用している認証**: APIキー（OAuthやサービスアカウントではない）
- **実装場所**: `services/geminiService.ts`
- **認証情報**: `.env.local` の `VITE_GEMINI_API_KEY`

### サービスアカウントは不要
現在の実装では、**サービスアカウントの作成は不要**です。理由：
- クライアントサイド（ブラウザ）から直接Gemini APIを呼び出している
- APIキーを使用した認証で十分
- サーバーサイドでの認証は不要

---

## ✅ 必要な設定（既に完了しているもの）

### 1. Generative Language APIの有効化
- ✅ 既に有効化されていることを確認済み

### 2. APIキーの作成
- ✅ APIキーを作成済み
- ✅ `.env.local` に設定済み

---

## 🔧 429エラー（クォータ超過）の確認と対処

### ステップ1: クォータの確認

1. **Google Cloud Consoleで「割り当てとシステム上限」タブを開く**
   - Generative Language APIの詳細ページで「割り当てとシステム上限」タブをクリック
   - 現在の使用状況と制限を確認

2. **確認すべき項目**:
   - **Requests per minute**: 1分間あたりのリクエスト数
   - **Requests per day**: 1日あたりのリクエスト数
   - **Tokens per minute**: 1分間あたりのトークン数
   - **現在の使用状況**: どの制限に達しているか

### ステップ2: APIキーの制限設定を確認

1. **Google Cloud Consoleで認証情報を確認**
   - 「APIとサービス」→「認証情報」を開く
   - 使用しているAPIキーを選択
   - 「APIの制限」セクションを確認

2. **確認すべき項目**:
   - **APIの制限**: 「Generative Language API」が選択されているか
   - **アプリケーションの制限**: 特定のHTTPリファラーが設定されていないか
   - **IPアドレスの制限**: 特定のIPアドレスが設定されていないか

### ステップ3: レート制限の確認

**無料プランの制限**:
- 1分間あたり: 15リクエスト
- 1日あたり: 1,500リクエスト
- 1分間あたりのトークン数: 1,000,000トークン

**有料プランの制限**:
- プランによって異なります
- 詳細は「割り当てとシステム上限」タブで確認

---

## 🛠️ 追加設定が必要な場合

### ケース1: クォータを増やしたい場合

1. **Google Cloud Consoleで「割り当てとシステム上限」を開く**
2. **「割り当ての増加をリクエスト」をクリック**
3. **必要なクォータを申請**

### ケース2: APIキーの制限を緩和したい場合

1. **Google Cloud Consoleで認証情報を開く**
2. **使用しているAPIキーを選択**
3. **「APIの制限」を「制限なし」に変更**（セキュリティリスクがあるため注意）
4. **または、特定のAPIのみ許可する設定を確認**

### ケース3: サーバーサイドに移行したい場合（オプション）

現在はクライアントサイドでAPIキーを使用していますが、セキュリティを向上させるためにサーバーサイドに移行することも可能です。

**メリット**:
- APIキーをクライアントに公開しない
- より細かい制御が可能

**デメリット**:
- 実装が複雑になる
- サーバーサイドのコストが発生

**必要な作業**:
1. Vercel Serverless Functionを作成
2. サーバーサイドでGemini APIを呼び出す
3. クライアントサイドからサーバーサイドAPIを呼び出す

**注意**: 現在の実装では、この移行は**必須ではありません**。APIキーを適切に管理していれば、クライアントサイドでの使用も問題ありません。

---

## 📋 確認チェックリスト

### 今すぐ確認すべき項目

- [ ] 「割り当てとシステム上限」タブでクォータの使用状況を確認
- [ ] APIキーの「APIの制限」設定を確認
- [ ] レート制限に達していないか確認
- [ ] しばらく待ってから再度試す（5-10分）

### 追加設定が必要な場合

- [ ] クォータを増やす必要があるか検討
- [ ] 有料プランへのアップグレードを検討
- [ ] APIキーの制限設定を見直す

---

## 🎯 推奨される次のステップ

1. **「割り当てとシステム上限」タブを確認**
   - どの制限に達しているか確認
   - 使用状況のグラフを確認

2. **しばらく待つ（5-10分）**
   - レート制限は時間とともにリセットされる
   - 再度チャンネル追加を試す

3. **それでもエラーが出る場合**
   - クォータの増加を申請
   - 有料プランへのアップグレードを検討

---

## ⚠️ 重要な注意事項

### サービスアカウントは不要
- 現在の実装では、サービスアカウントの作成は**不要**です
- APIキーを使用した認証で十分です

### APIキーのセキュリティ
- APIキーは`.env.local`に保存されているため、Gitにコミットしないでください
- `.gitignore`に`.env.local`が含まれていることを確認してください

### クォータの管理
- 無料プランには制限があります
- 頻繁に使用する場合は、有料プランへのアップグレードを検討してください

---

## 📝 参考リンク

- [Gemini API Rate Limits](https://ai.google.dev/gemini-api/docs/rate-limits)
- [Google Cloud Console - Quotas](https://console.cloud.google.com/apis/api/generativelanguage.googleapis.com/quotas)
- [API Key Best Practices](https://cloud.google.com/docs/authentication/api-keys)

