# タイトル不一致問題の原因と解決策

## 🔍 問題の原因

### 現在の実装

1. **Gemini APIが`googleSearch`ツールを使用**
   - 検索結果から動画情報を取得
   - タイトルは検索結果のメタデータから取得

2. **問題点**
   - 検索結果のタイトルが、実際のYouTubeのタイトルと完全に一致しない可能性
   - Gemini APIがタイトルを解釈・加工する可能性
   - 検索結果のタイトルが省略されている可能性
   - 検索結果のタイトルが異なる言語で返される可能性

### 例

- **実際のYouTubeタイトル**: "【銘柄勉強会】PER8倍の成長企業!? 今後の成長戦略についてCFOに直接聞いてみた! (イー・ギャランティ)"
- **Gemini APIが返すタイトル**: "PER8倍の成長企業 イー・ギャランティ CFOに聞く成長戦略"（加工された可能性）

---

## ✅ 解決策

### オプション1: YouTube Data API v3を使用（推奨）

VIDEO_IDから正確なタイトルを取得する方法：

**メリット**:
- YouTubeの公式APIを使用するため、タイトルが100%正確
- メタデータ（公開日時、説明文など）も正確に取得可能

**デメリット**:
- YouTube Data API v3のAPIキーが必要
- APIクォータの制限がある（1日10,000ユニット）

### オプション2: プロンプトの改善

Gemini APIのプロンプトを改善して、タイトルを正確に取得するように指示：

**改善点**:
- 「動画のタイトルは、YouTubeに表示されているタイトルをそのまま、一字一句正確に取得してください」
- 「タイトルを加工したり、要約したりしないでください」
- 「タイトルは完全一致で取得してください」

### オプション3: タイトルの正規化

タイトルを正規化して比較する方法：

**正規化の内容**:
- 空白の削除
- 大文字小文字の統一
- 特殊文字の正規化

**問題点**:
- タイトルが根本的に異なる場合、正規化しても一致しない

### オプション4: VIDEO_IDのみに依存

タイトルでの重複チェックを削除し、VIDEO_IDのみに依存：

**メリット**:
- VIDEO_IDは一意で不変
- 最も確実な重複チェック方法

**デメリット**:
- VIDEO_IDが抽出できない場合、重複チェックが機能しない

---

## 🎯 推奨される解決策

### 短期解決策: プロンプトの改善

Gemini APIのプロンプトを改善して、タイトルを正確に取得するように指示します。

### 長期解決策: YouTube Data API v3の統合

VIDEO_IDから正確なタイトルを取得するために、YouTube Data API v3を統合します。

---

## 📝 実装の優先順位

1. **プロンプトの改善**（即座に実装可能）
2. **YouTube Data API v3の統合**（より確実だが、APIキーが必要）

