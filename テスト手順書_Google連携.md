# テスト手順書 - Google連携機能

## 📋 テストの全体フロー

1. **基本機能のテスト**（チャンネル追加、Supabase接続）
2. **Google OAuth認証のテスト**
3. **Googleドキュメント作成のテスト**
4. **Google Chat通知のテスト**

---

## ✅ ステップ1: 基本機能のテスト

### 1.1 Supabase接続確認

1. ブラウザで `http://localhost:3000` を開く
2. 開発者ツール（F12）を開く
3. コンソールタブで以下を確認：

**期待される表示**:
```
✅ Supabase接続設定が確認されました
✅ Gemini APIキーが正常に設定されました
```

### 1.2 チャンネル追加テスト

1. 「チャンネルを追加」セクションで、チャンネル名または@ハンドルを入力
   - 例: `@YouTube` または `YouTube`
2. 「+」ボタンをクリック
3. 確認項目:
   - [ ] チャンネルが「監視中」セクションに表示される
   - [ ] コンソールにエラーが表示されない
   - [ ] Supabaseの`channels`テーブルにデータが保存される（オプション: Supabaseダッシュボードで確認）

---

## 🔐 ステップ2: Google OAuth認証のテスト

### 2.1 Google Cloud Console設定（初回のみ）

**前提条件**: Google Cloud ConsoleでOAuth 2.0クライアントIDを作成済み

1. [Google Cloud Console](https://console.cloud.google.com) にアクセス
2. プロジェクトを選択（または新規作成）
3. 「APIとサービス」→「認証情報」を開く
4. 「+ 認証情報を作成」→「OAuth 2.0 クライアントID」を選択
5. アプリケーションタイプ: 「ウェブアプリケーション」
6. **承認済みのJavaScript生成元**:
   ```
   http://localhost:3000
   ```
7. **承認済みのリダイレクトURI**:
   ```
   http://localhost:3000
   ```
8. 「作成」をクリック
9. **Client ID** をコピー（例: `123456789-abcdefghijklmnop.apps.googleusercontent.com`）

### 2.2 必要なAPIの有効化

1. Google Cloud Consoleで「APIとサービス」→「ライブラリ」を開く
2. 以下のAPIを検索して有効化：
   - ✅ **Google Drive API**
   - ✅ **Google Docs API**

### 2.3 アプリ内での認証テスト

1. アプリの「連携設定」セクションで、Google Client IDを入力
   - 例: `123456789-abcdefghijklmnop.apps.googleusercontent.com`
2. 「Googleと連携する」ボタンをクリック
3. **期待される動作**:
   - [ ] Google認証画面が新しいタブ/ウィンドウで開く
   - [ ] Googleアカウントを選択（複数アカウントがある場合）
   - [ ] 権限の承認画面が表示される
   - [ ] 「YouTube Insight Hub が次の権限をリクエストしています」と表示される
   - [ ] 権限を承認すると、元のページに戻る
   - [ ] 「Google 接続済み」または類似のメッセージが表示される

### 2.4 認証状態の確認

1. 開発者ツール（F12）を開く
2. 「Application」タブ（Chrome）または「ストレージ」タブ（Firefox）を開く
3. 「Session Storage」を確認
4. 確認項目:
   - [ ] `google_access_token` が保存されている
   - [ ] トークンの値が表示されている（長い文字列）

---

## 📄 ステップ3: Googleドキュメント作成のテスト

### 3.1 動画スキャンの実行

**前提条件**: 
- Google認証が完了している
- チャンネルが1つ以上追加されている

1. 「最新をチェック」ボタンをクリック
2. **期待される動作**:
   - [ ] 「スキャン中...」と表示される
   - [ ] 数秒〜数十秒待つ（Gemini APIの処理時間）
   - [ ] 新しい要約カードが表示される

### 3.2 Googleドキュメントの確認

1. 要約カードに「📄 要約をGoogleドキュメントで見る」ボタンが表示されることを確認
2. ボタンをクリック
3. **期待される動作**:
   - [ ] 新しいタブでGoogleドキュメントが開く
   - [ ] ドキュメントに以下が含まれている：
     - ✅ 動画のタイトル
     - ✅ チャンネル名
     - ✅ 公開日
     - ✅ 要約文（200文字程度）
     - ✅ 重要なポイント（3つ）

### 3.3 Google Driveでの確認

1. [Google Drive](https://drive.google.com) にアクセス
2. 「YouTube Insight Hub」フォルダを探す（自動的に作成される）
3. 確認項目:
   - [ ] フォルダが存在する
   - [ ] フォルダ内に要約ドキュメントが保存されている
   - [ ] ドキュメント名が動画タイトルになっている

### 3.4 自動保存の確認

1. 再度「最新をチェック」をクリック
2. 新しい要約が生成される
3. 確認項目:
   - [ ] 新しい要約が自動的にGoogleドキュメントに保存される（手動でボタンをクリックしなくても）
   - [ ] Google Driveの「YouTube Insight Hub」フォルダに新しいドキュメントが追加される

---

## 💬 ステップ4: Google Chat通知のテスト

### 4.1 Google Chat Webhook URLの取得

1. [Google Chat](https://chat.google.com) にアクセス
2. 通知を受け取りたいスペース（チャットルーム）を開く
3. スペース名の横の「⋮」（三点メニュー）をクリック
4. 「アプリと統合」→「Webhookを管理」を選択
5. 「Webhookを追加」をクリック
6. Webhook名を入力（例: `YouTube Insight Hub`）
7. 「保存」をクリック
8. **Webhook URL** をコピー（例: `https://chat.googleapis.com/v1/spaces/XXXXX/messages?key=YYYYY&token=ZZZZZ`）

### 4.2 アプリ内での設定

1. アプリの「GOOGLE CHAT通知」セクションで、Webhook URLを入力
2. 「新しい要約を自動的にGoogle Chatに通知」にチェックを入れる
3. 設定が保存されることを確認

### 4.3 通知のテスト

1. 「最新をチェック」をクリックして新しい要約を生成
2. **期待される動作**:
   - [ ] Google Chatのスペースに通知が送信される
   - [ ] 通知に以下が含まれる：
     - ✅ 動画のタイトル
     - ✅ チャンネル名
     - ✅ Googleドキュメントへのリンク
     - ✅ 動画URL（オプション）

### 4.4 通知内容の確認

Google Chatで受信した通知を確認：
- [ ] メッセージが正しく表示される
- [ ] リンクがクリック可能である
- [ ] Googleドキュメントへのリンクが正しく動作する

---

## ⚠️ トラブルシューティング

### 問題1: Google認証が開かない

**症状**: 「Googleと連携する」をクリックしても何も起こらない

**確認項目**:
1. Google Client IDが正しく入力されているか
2. コンソールにエラーメッセージが表示されていないか
3. ポップアップブロッカーが有効になっていないか

**解決方法**:
- ブラウザのポップアップを許可する
- Google Client IDを再確認
- 開発者ツールのコンソールでエラーを確認

### 問題2: 認証後に403エラーが表示される

**症状**: Google認証画面で「このアプリは確認されていません」と表示される

**解決方法**:
1. Google Cloud Consoleで「OAuth同意画面」を設定
2. テストユーザーとして自分のGoogleアカウントを追加
3. アプリケーションタイプを「内部」または「外部」に設定

### 問題3: Googleドキュメントが作成されない

**症状**: スキャンは成功するが、Googleドキュメントが作成されない

**確認項目**:
1. Google認証が完了しているか（Session Storageに`google_access_token`があるか）
2. Google Drive APIとGoogle Docs APIが有効化されているか
3. コンソールにエラーメッセージが表示されていないか

**解決方法**:
- Google認証を再度実行
- Google Cloud ConsoleでAPIの有効化を確認
- コンソールのエラーメッセージを確認

### 問題4: Google Chat通知が送信されない

**症状**: 要約は生成されるが、Google Chatに通知が届かない

**確認項目**:
1. Webhook URLが正しく入力されているか
2. 「新しい要約を自動的にGoogle Chatに通知」にチェックが入っているか
3. コンソールにエラーメッセージが表示されていないか

**解決方法**:
- Webhook URLを再確認
- Google ChatのWebhookが有効か確認
- コンソールのエラーメッセージを確認

---

## ✅ テスト完了チェックリスト

すべてのテストが完了したら、以下を確認：

- [ ] Supabase接続が正常に動作する
- [ ] チャンネル追加機能が動作する
- [ ] Google OAuth認証が正常に動作する
- [ ] Googleドキュメントが自動的に作成される
- [ ] Google Driveに「YouTube Insight Hub」フォルダが作成される
- [ ] Google Chat通知が正常に送信される（設定済みの場合）
- [ ] データベースにデータが正しく保存される

---

## 🎯 次のステップ

すべてのテストが完了したら：

1. **定期クローリング機能の実装**（フェーズ3）
2. **Webhook機能の実装**（フェーズ4）
3. **Vercelへのデプロイ**

現在の実装状況を確認して、次のステップに進みましょう！

